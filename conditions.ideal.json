{
  "_comment": "IDEAL CONDITIONS - BLOCKED by TaCo SDK max nested depth of 2. Current nesting: AND → sequential → OR = depth 3. Need depth limit increased to 3+.",
  "_blocking_issue": "Variables defined in sequential block cannot be accessed in sibling compound blocks, so the OR must be inside sequential, but that exceeds depth limit.",
  "version": "1.0.0",
  "condition": {
    "conditionType": "compound",
    "operator": "and",
    "operands": [
      {
        "conditionType": "compound",
        "operator": "or",
        "operands": [
          {
            "message": ":timestamp:discordPayload",
            "signature": ":signature",
            "verifyingKey": "db55ffb861ef97174c5da1563491ae39444851930aca9111039d875ca7812c23",
            "curve": "Ed25519",
            "conditionType": "ecdsa"
          },
          {
            "message": ":timestamp:discordPayload",
            "signature": ":signature",
            "verifyingKey": "845e32f597ba70fba3586cbd0acbed78b40e01df4b940d01f7a74ee1fd7a43b8",
            "curve": "Ed25519",
            "conditionType": "ecdsa"
          },
          {
            "message": ":timestamp:discordPayload",
            "signature": ":signature",
            "verifyingKey": "d13fe84b134026fc0b26667ea3880779ad1b5dec2170561136929b479ed68800",
            "curve": "Ed25519",
            "conditionType": "ecdsa"
          }
        ]
      },
      {
        "conditionType": "sequential",
        "conditionVariables": [
          {
            "varName": "senderSalt",
            "condition": {
              "conditionType": "json",
              "data": ":discordPayload",
              "query": "$.member.user.id",
              "returnValueTest": {
                "comparator": ">",
                "value": 0
              }
            },
            "operations": [
              {
                "operation": "+=",
                "value": "|Discord|Collab.Land"
              },
              {
                "operation": "keccak"
              }
            ]
          },
          {
            "varName": "senderAA",
            "condition": {
              "conditionType": "contract",
              "contractAddress": "0x69Aa2f9fe1572F1B640E1bbc512f5c3a734fc77c",
              "chain": 84532,
              "method": "computeAddress",
              "functionAbi": {
                "name": "computeAddress",
                "type": "function",
                "inputs": [
                  {
                    "name": "_bytecodeHash",
                    "type": "bytes32",
                    "internalType": "bytes32"
                  },
                  {
                    "name": "_salt",
                    "type": "bytes32",
                    "internalType": "bytes32"
                  }
                ],
                "outputs": [
                  {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                  }
                ],
                "stateMutability": "view"
              },
              "parameters": [
                "0x210ffc0da7f274285c4d6116aaef8420ecb9054faced33862197d6b951cb32f5",
                ":senderSalt"
              ],
              "returnValueTest": {
                "comparator": "!=",
                "value": "0x0000000000000000000000000000000000000000"
              }
            }
          },
          {
            "varName": "validateSender",
            "condition": {
              "signingObjectContextVar": ":signingConditionObject",
              "attributeName": "sender",
              "conditionType": "signing-attribute",
              "returnValueTest": {
                "comparator": "==",
                "value": ":senderAA"
              }
            }
          },
          {
            "varName": "amountEth",
            "condition": {
              "conditionType": "json",
              "data": ":discordPayload",
              "query": "$.data.options[0].options[?(@.name == \"amount\")].value",
              "returnValueTest": {
                "comparator": ">",
                "value": 0,
                "operations": [
                  {
                    "operation": "float"
                  }
                ]
              }
            },
            "operations": [
              {
                "operation": "ethToWei"
              }
            ]
          },
          {
            "varName": "amountUsdc",
            "condition": {
              "conditionType": "json",
              "data": ":discordPayload",
              "query": "$.data.options[0].options[?(@.name == \"amount\")].value",
              "returnValueTest": {
                "comparator": ">",
                "value": 0,
                "operations": [
                  {
                    "operation": "float"
                  }
                ]
              }
            },
            "operations": [
              {
                "operation": "*=",
                "value": 1000000
              }
            ]
          },
          {
            "varName": "recipientSalt",
            "condition": {
              "conditionType": "json",
              "data": ":discordPayload",
              "query": "$.data.options[0].options[?(@.name == \"receiver\")].value",
              "returnValueTest": {
                "comparator": ">",
                "value": 0
              }
            },
            "operations": [
              {
                "operation": "+=",
                "value": "|Discord|Collab.Land"
              },
              {
                "operation": "keccak"
              }
            ]
          },
          {
            "varName": "recipientAA",
            "condition": {
              "conditionType": "contract",
              "contractAddress": "0x69Aa2f9fe1572F1B640E1bbc512f5c3a734fc77c",
              "chain": 84532,
              "method": "computeAddress",
              "functionAbi": {
                "name": "computeAddress",
                "type": "function",
                "inputs": [
                  {
                    "name": "_bytecodeHash",
                    "type": "bytes32",
                    "internalType": "bytes32"
                  },
                  {
                    "name": "_salt",
                    "type": "bytes32",
                    "internalType": "bytes32"
                  }
                ],
                "outputs": [
                  {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                  }
                ],
                "stateMutability": "view"
              },
              "parameters": [
                "0x210ffc0da7f274285c4d6116aaef8420ecb9054faced33862197d6b951cb32f5",
                ":recipientSalt"
              ],
              "returnValueTest": {
                "comparator": "!=",
                "value": "0x0000000000000000000000000000000000000000"
              }
            }
          },
          {
            "_comment": "THIS IS THE BLOCKER - compound OR inside sequential exceeds max depth of 2",
            "varName": "validateCalldata",
            "condition": {
              "conditionType": "compound",
              "operator": "or",
              "operands": [
                {
                  "_comment": "ETH transfer validation",
                  "signingObjectContextVar": ":signingConditionObject",
                  "attributeName": "call_data",
                  "conditionType": "signing-abi-attribute",
                  "abiValidation": {
                    "allowedAbiCalls": {
                      "execute((address,uint256,bytes))": [
                        {
                          "parameterIndex": 0,
                          "indexWithinTuple": 0,
                          "returnValueTest": {
                            "comparator": "==",
                            "value": ":recipientAA"
                          }
                        },
                        {
                          "parameterIndex": 0,
                          "indexWithinTuple": 1,
                          "returnValueTest": {
                            "comparator": "==",
                            "value": ":amountEth"
                          }
                        }
                      ]
                    }
                  }
                },
                {
                  "_comment": "USDC transfer validation with nestedAbiValidation for ERC-20 transfer call",
                  "signingObjectContextVar": ":signingConditionObject",
                  "attributeName": "call_data",
                  "conditionType": "signing-abi-attribute",
                  "abiValidation": {
                    "allowedAbiCalls": {
                      "execute((address,uint256,bytes))": [
                        {
                          "parameterIndex": 0,
                          "indexWithinTuple": 0,
                          "returnValueTest": {
                            "comparator": "==",
                            "value": "0x036CbD53842c5426634e7929541eC2318f3dCF7e"
                          }
                        },
                        {
                          "parameterIndex": 0,
                          "indexWithinTuple": 1,
                          "returnValueTest": {
                            "comparator": "==",
                            "value": 0
                          }
                        },
                        {
                          "parameterIndex": 0,
                          "indexWithinTuple": 2,
                          "nestedAbiValidation": {
                            "allowedAbiCalls": {
                              "transfer(address,uint256)": [
                                {
                                  "parameterIndex": 0,
                                  "returnValueTest": {
                                    "comparator": "==",
                                    "value": ":recipientAA"
                                  }
                                },
                                {
                                  "parameterIndex": 1,
                                  "returnValueTest": {
                                    "comparator": "==",
                                    "value": ":amountUsdc"
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              ]
            }
          }
        ]
      }
    ]
  },
  "_sdk_requirements": {
    "CRITICAL_BLOCKER": {
      "issue": "max_nested_depth must be increased from 2 to 3",
      "reason": "ERC-20 validation requires: AND (signatures) → sequential (derive variables) → OR (ETH vs ERC-20 calldata)",
      "current_depth_limit": 2,
      "required_depth": 3,
      "error_message": "Exceeded max nested depth of 2 for multi-condition type"
    },
    "why_sibling_blocks_dont_work": "Variables like :recipientAA and :amountEth defined in sequential block are not accessible in sibling compound blocks - they become 'missing custom context parameters'",
    "max_condition_variables_for_dynamic": 12,
    "features_needed_for_dynamic_tokens": [
      "Variable interpolation in json-api endpoint URLs (e.g., /data/:tokenTicker/data.json)",
      "Literal values in context-variable (not requiring : prefix, e.g., contextVariable: '18')",
      "Exponent operator (**=) would simplify tokenMultiplier calculation"
    ],
    "benefits_when_unblocked": [
      "Support ETH + USDC + any other ERC-20 tokens",
      "nestedAbiValidation decodes inner transfer(address,uint256) call",
      "Adding new tokens only requires updating Discord command choices (with dynamic API lookup)"
    ]
  }
}
